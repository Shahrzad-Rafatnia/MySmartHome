// Generated by CoffeeScript 1.6.2
/*
Calculations page!

Do calculations for engineers or something.
*/
require(['jquery', 'underscore', 'vendor/jquery.jdpicker'], function($, _) {
  "use strict";
  var CALCULATE_URL, deboog, renderResults, __renderer;

  deboog = false;
  CALCULATE_URL = deboog ? '/HomeWatch/engineer/samplecalc.json' : '/HomeWatch/engineer/calculate.php';
  window.calculate = function() {
    var calcDD, calcName, calculateButton, calculation, enddate, endhour, energy, energyDD, energyName, startdate, starthour;

    calcDD = $("#calculations");
    calculation = calcDD.val();
    calcName = calcDD.children(':selected').text();
    energyDD = $('#energies');
    energy = energyDD.val();
    energyName = energyDD.children(':selected').text();
    startdate = $('#startdate').val();
    enddate = $('#enddate').val();
    starthour = $('#starthour').val();
    endhour = $('#endhour').val();
    calculateButton = $('#calculateButton').text('calculating...').attr('disabled', true);
    $.getJSON(CALCULATE_URL, {
      name: calcName,
      energyname: energyName,
      calculation: calculation,
      energy: energy,
      startdate: startdate,
      enddate: enddate,
      starthour: starthour,
      endhour: endhour
    }).done(function(data) {
      var resultsdiv;

      return resultsdiv = $('#results').html(renderResults(data));
    }).fail(function(data) {
      return alert("Error Doing Calculations: " + (data.responseText ? data.responseText : data.statusText));
    }).always(function() {
      calculateButton.removeAttr('disabled');
      return calculateButton.text('Calculate');
    });
    return false;
  };
  /*
  Toggles the display of the energies subtype drop-down.
  */

  window.showhideEnergiesOnChange = function(dropdown) {
    var calcType, subDropDown;

    calcType = $(dropdown).val();
    subDropDown = $('#energies');
    return subDropDown.attr('disabled', calcType !== 'eq1');
  };

  __renderer = _.template("  <ul>    <% _.each(results, function (pair) { " +
  		"if (pair.key == 'pie') { %>" +
  		"<br/><br/><img src='https://chart.googleapis.com/chart?cht=p3&chs=600x250&chd=t:<%= pair.values %>&chl=<%= pair.names %>&chco=00FF00|0000FF|FFFF00|FF0000'/>" +
  		"<% } else { %>   " +
  		" <li><strong> <%= pair.key %> </strong> = <%= pair.val %></li>   " +
  		" <% }}) %>  </ul>  ");
  renderResults = function(results) {
    return __renderer({
      results: results
    });
  };
  return $(function() {
    var datePickers;

    datePickers = $('#startdate, #enddate');
    datePickers.attr('type', 'hidden');
    
    var today = new Date();
    datePickers.each(function() {
        $(this).val(today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate());
    });
    
    return datePickers.jdPicker({
      date_format: 'YYYY-mm-dd',
      start_of_week: 0
    });
  });
});
